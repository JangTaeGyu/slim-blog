{% extends "layout/admin_app.twig" %}

{% set title = trash ? '휴지통' : '관리' %}
{% set title = '방명록 ' ~ title %}
{% set csrf_input = csrf_input() %}

{% block title %}{{ title }}{% endblock %}

{% block style %}
    <style>
        .pagination { list-style: none; padding: 0; margin: 0; }
        .pagination > li { display: inline-block; padding: 0 5px; }
        .pagination > li > a { text-decoration: none; }
        .pagination > li.active > span { font-size: 18px; font-weight: bold; }
        .guestbook { list-style: none; padding: 0; margin: 0; }
        .guestbook > li { padding: 10px; border-bottom: 1px solid #ccc; }
        .guestbook > li > p { padding: 5px 0; margin: 0; }
        form { display: inline-block; }
    </style>
{% endblock %}

{% block content %}
<h1>{{ title }} <small>{{ guestbooks.total }}건</small></h1>

{% if trash %}
    <a href="{{ path_for('blog.admin.guestbook.index') }}">방명록 관리</a>
{% else %}
    <a href="{{ path_for('blog.admin.guestbook.trash') }}">방명록 휴지통</a>
{% endif %}

<ul class="guestbook">
    {% for guestbook in guestbooks %}
    <li>
        <span>{{ guestbook.name }}</span>
        <span>{{ guestbook.ip }}</span>
        <span>{{ guestbook.created_at }}</span>
        <p>{{ guestbook.comment }}</p>

        {% if trash %}
            {{ form_open('DELETE', { action: path_for('blog.admin.guestbook.destroy', { guestbook_id: guestbook.id }) }) }}
                {{ csrf_input | raw }}
                <input type="hidden" name="trash" value="{{ trash ? 1 : 0 }}">
                <button type="submit">삭제하기</button>
            {{ form_close() }}
        {% else %}
            {% if guestbook.parent_id is null %}
                {{ form_open('GET', { action: path_for('blog.admin.guestbook.create', { parent_id: guestbook.id }) }) }}
                    <button type="submit">답글쓰기</button>
                {{ form_close() }}
            {% endif %}
        {% endif %}

        {{ form_open('PUT', { action: path_for('blog.admin.guestbook.update', { guestbook_id: guestbook.id }) }) }}
            {{ csrf_input | raw }}
            <input type="hidden" name="approved" value="{{ trash ? 1 : 0 }}">
            <input type="hidden" name="trash" value="{{ trash ? 1 : 0 }}">
            <button type="submit">{{ trash ? '복구하기' : '휴지통 보내기' }}</button>
        {{ form_close() }}
    </li>
    {% endfor %}
</ul>

{{ guestbooks.links('pagination/default.twig') | raw }}

{% endblock %}
